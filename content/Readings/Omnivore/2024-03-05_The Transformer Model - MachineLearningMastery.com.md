---
id: 90ae30e2-6015-483b-aac6-3a16ebdc9bb5
title: |
  The Transformer Model - MachineLearningMastery.com
author: |
  Stefania Cristina
date_saved: 2024-03-05 16:39:43
date_published: 2022-09-17 16:00:23
draft: true
---

# The Transformer Model - MachineLearningMastery.com
#Omnivore

[Read on Omnivore](https://omnivore.app/me/the-transformer-model-machine-learning-mastery-com-18e108ee2ba)

[Read Original](https://machinelearningmastery.com/the-transformer-model/)

date_saved: 2024-03-05 16:39:43

date_published: 2022-09-17 16:00:23

--- 

# Full Content: 

We have already familiarized ourselves with the concept of self-attention as implemented by the Transformer attention mechanism for neural machine translation. We will now be shifting our focus to the details of the Transformer architecture itself to discover how self-attention can be implemented without relying on the use of recurrence and convolutions.

In this tutorial, you will discover the network architecture of the Transformer model.

After completing this tutorial, you will know:

* How the Transformer architecture implements an encoder-decoder structure without recurrence and convolutions
* How the Transformer encoder and decoder work
* How the Transformer self-attention compares to the use of recurrent and convolutional layers

**Kick-start your project** with my book [Building Transformer Models with Attention](https://machinelearningmastery.com/transformer-models-with-attention/). It provides **self-study tutorials** with **working code** to guide you into building a fully-working transformer model that can  
_translate sentences from one language to another_...

Let’s get started. 

[![](https://proxy-prod.omnivore-image-cache.app/1024x785,sLynww9O9Tf1vwneXosqJgw3VXAjDF5m_Uut53FIaDnQ/https://machinelearningmastery.com/wp-content/uploads/2021/10/transformer_cover-1-1024x785.jpg)](https://machinelearningmastery.com/wp-content/uploads/2021/10/transformer%5Fcover-1-scaled.jpg)

The Transformer Model   
Photo by [Samule Sun](https://unsplash.com/photos/vuMTQj6aQQ0), some rights reserved.

## **Tutorial Overview**

This tutorial is divided into three parts; they are:

* The Transformer Architecture  
   * The Encoder  
   * The Decoder
* Sum Up: The Transformer Model
* Comparison to Recurrent and Convolutional Layers

## **Prerequisites**

For this tutorial, we assume that you are already familiar with:

* [The concept of attention](https://machinelearningmastery.com/what-is-attention/)
* [The attention mechanism](https://machinelearningmastery.com/the-attention-mechanism-from-scratch/)
* [The Transformer attention mechanism](https://machinelearningmastery.com/the-transformer-attention-mechanism)

## **The Transformer Architecture**

The Transformer architecture follows an encoder-decoder structure but does not rely on recurrence and convolutions in order to generate an output. 

In a nutshell, the task of the encoder, on the left half of the Transformer architecture, is to map an input sequence to a sequence of continuous representations, which is then fed into a decoder. 

The decoder, on the right half of the architecture, receives the output of the encoder together with the decoder output at the previous time step to generate an output sequence.

> _At each step the model is auto-regressive, consuming the previously generated symbols as additional input when generating the next._
> 
> _–_ [Attention Is All You Need](https://arxiv.org/abs/1706.03762), 2017.

### **The Encoder**

The encoder consists of a stack of = 6 identical layers, where each layer is composed of two sublayers:

1. The first sublayer implements a multi-head self-attention mechanism. [You have seen](https://machinelearningmastery.com/the-transformer-attention-mechanism) that the multi-head mechanism implements heads that receive a (different) linearly projected version of the queries, keys, and values, each to produce outputs in parallel that are then used to generate a final result.
1. The second sublayer is a fully connected feed-forward network consisting of two linear transformations with Rectified Linear Unit (ReLU) activation in between:

The six layers of the Transformer encoder apply the same linear transformations to all the words in the input sequence, but _each_ layer employs different weight () and bias () parameters to do so. 

Furthermore, each of these two sublayers has a residual connection around it.

Each sublayer is also succeeded by a normalization layer, , which normalizes the sum computed between the sublayer input, , and the output generated by the sublayer itself, :

An important consideration to keep in mind is that the Transformer architecture cannot inherently capture any information about the relative positions of the words in the sequence since it does not make use of recurrence. This information has to be injected by introducing _positional encodings_ to the input embeddings. 

The positional encoding vectors are of the same dimension as the input embeddings and are generated using sine and cosine functions of different frequencies. Then, they are simply summed to the input embeddings in order to _inject_ the positional information.

### **The Decoder** 

The decoder shares several similarities with the encoder. 

The decoder also consists of a stack of = 6 identical layers that are each composed of three sublayers:

1. The first sublayer receives the previous output of the decoder stack, augments it with positional information, and implements multi-head self-attention over it. While the encoder is designed to attend to all words in the input sequence _regardless_ of their position in the sequence, the decoder is modified to attend _only_ to the preceding words. Hence, the prediction for a word at position can only depend on the known outputs for the words that come before it in the sequence. In the multi-head attention mechanism (which implements multiple, single attention functions in parallel), this is achieved by introducing a mask over the values produced by the scaled multiplication of matrices and . This masking is implemented by suppressing the matrix values that would otherwise correspond to illegal connections:

[![](https://proxy-prod.omnivore-image-cache.app/177x298,sOmv5jI-ufsm8IRN0VpBvhRvjzwim99IgComYD5yuDIw/https://machinelearningmastery.com/wp-content/uploads/2021/09/tour_3-609x1024.png)](https://machinelearningmastery.com/wp-content/uploads/2021/09/tour%5F3.png)

The multi-head attention in the decoder implements several masked, single-attention functions   
Taken from “[Attention Is All You Need](https://arxiv.org/abs/1706.03762)“

> _The masking makes the decoder unidirectional (unlike the bidirectional encoder)._
> 
> _–_ [Advanced Deep Learning with Python](https://www.amazon.com/Advanced-Deep-Learning-Python-next-generation/dp/178995617X), 2019.

1. The second layer implements a multi-head self-attention mechanism similar to the one implemented in the first sublayer of the encoder. On the decoder side, this multi-head mechanism receives the queries from the previous decoder sublayer and the keys and values from the output of the encoder. This allows the decoder to attend to all the words in the input sequence.
1. The third layer implements a fully connected feed-forward network, similar to the one implemented in the second sublayer of the encoder.

Furthermore, the three sublayers on the decoder side also have residual connections around them and are succeeded by a normalization layer.

Positional encodings are also added to the input embeddings of the decoder in the same manner as previously explained for the encoder.   

### Want to Get Started With Building Transformer Models with Attention?

Take my free 12-day email crash course now (with sample code).

Click to sign-up and also get a free PDF Ebook version of the course.

Download Your FREE Mini-Course

The Transformer model runs as follows:

1. Each word forming an input sequence is transformed into a -dimensional embedding vector.
1. Each embedding vector representing an input word is augmented by summing it (element-wise) to a positional encoding vector of the same length, hence introducing positional information into the input.
1. The augmented embedding vectors are fed into the encoder block consisting of the two sublayers explained above. Since the encoder attends to all words in the input sequence, irrespective if they precede or succeed the word under consideration, then the Transformer encoder is _bidirectional_.
1. The decoder receives as input its own predicted output word at time-step, .
1. The input to the decoder is also augmented by positional encoding in the same manner done on the encoder side.
1. The augmented decoder input is fed into the three sublayers comprising the decoder block explained above. Masking is applied in the first sublayer in order to stop the decoder from attending to the succeeding words. At the second sublayer, the decoder also receives the output of the encoder, which now allows the decoder to attend to all the words in the input sequence.
1. The output of the decoder finally passes through a fully connected layer, followed by a softmax layer, to generate a prediction for the next word of the output sequence.

## **Comparison to Recurrent and Convolutional Layers**

[Vaswani et al. (2017)](https://arxiv.org/abs/1706.03762) explain that their motivation for abandoning the use of recurrence and convolutions was based on several factors:

1. Self-attention layers were found to be faster than recurrent layers for shorter sequence lengths and can be restricted to consider only a neighborhood in the input sequence for very long sequence lengths.
1. The number of sequential operations required by a recurrent layer is based on the sequence length, whereas this number remains constant for a self-attention layer.
1. In convolutional neural networks, the kernel width directly affects the long-term dependencies that can be established between pairs of input and output positions. Tracking long-term dependencies would require using large kernels or stacks of convolutional layers that could increase the computational cost.

## **Further Reading**

This section provides more resources on the topic if you are looking to go deeper.

### **Books**

* [Advanced Deep Learning with Python](https://www.amazon.com/Advanced-Deep-Learning-Python-next-generation/dp/178995617X), 2019.

### **Papers**

* [Attention Is All You Need](https://arxiv.org/abs/1706.03762), 2017.

## **Summary**

In this tutorial, you discovered the network architecture of the Transformer model.

Specifically, you learned:

* How the Transformer architecture implements an encoder-decoder structure without recurrence and convolutions
* How the Transformer encoder and decoder work
* How the Transformer self-attention compares to recurrent and convolutional layers

Do you have any questions?  
Ask your questions in the comments below, and I will do my best to answer.

## Learn Transformers and Attention!

[![Building Transformer Models with Attention](https://proxy-prod.omnivore-image-cache.app/220x293,sj3bUkDCKPogwwWjG_VEn7Dw7KIfcSwldvJ9AbcNJbro/https://machinelearningmastery.com/wp-content/uploads/2022/11/BTMA-400.png)](https://machinelearningmastery.com/transformer-models-with-attention/)

#### Teach your deep learning model to read a sentence

...using transformer models with attention

Discover how in my new Ebook:  
[Building Transformer Models with Attention](https://machinelearningmastery.com/transformer-models-with-attention/)

It provides **self-study tutorials** with **working code** to guide you into building a fully-working transformer models that can  
_translate sentences from one language to another_...

#### Give magical power of understanding human language for   
Your Projects

[See What's Inside](https://machinelearningmastery.com/transformer-models-with-attention/)

---

